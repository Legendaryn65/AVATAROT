<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AVATAROT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050608;
      --panel: #101219;
      --accent: #f5d27c;
      --accent-soft: rgba(245, 210, 124, 0.15);
      --text: #f6f6f6;
      --muted: #a1a5b5;
      --border: #242733;
      --radius-lg: 16px;
      --radius-md: 10px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background: radial-gradient(circle at top, #1c2030 0, #050608 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 900px;
      margin: auto;
      background: linear-gradient(145deg, #080910, #111320);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(245, 210, 124, 0.3);
      box-shadow:
        0 18px 60px rgba(0, 0, 0, 0.75),
        0 0 30px rgba(245, 210, 124, 0.12);
      padding: 18px 14px 20px;
    }

    @media (min-width: 720px) {
      .app {
        padding: 20px 24px 26px;
      }
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .title {
      font-size: 20px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .subtitle {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      padding: 10px 10px;
      border-radius: var(--radius-md);
      background: radial-gradient(circle at top left, #181a26 0, #060710 60%);
      border: 1px solid var(--border);
      margin-bottom: 14px;
    }

    .controls label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
    }

    .controls select {
      background: #151726;
      color: var(--text);
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 6px 26px 6px 12px;
      font-size: 12px;
      outline: none;
      appearance: none;
      position: relative;
    }

    .controls select:focus {
      border-color: var(--accent);
    }

    .controls button {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #141622;
      color: var(--text);
      font-size: 12px;
      padding: 7px 12px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .controls button.primary {
      background: radial-gradient(circle at top, #f5d27c 0, #c88c3a 60%);
      color: #111014;
      border-color: #f5d27c;
      font-weight: 600;
    }

    .controls button:hover {
      opacity: 0.9;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-left: auto;
    }

    .spread-panel {
      background: radial-gradient(circle at top, #171927 0, #05060d 60%);
      border-radius: var(--radius-md);
      border: 1px solid rgba(245, 210, 124, 0.16);
      padding: 14px 10px 16px;
      margin-bottom: 12px;
    }

    .spread-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .spread-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
    }

    .spread-meta {
      font-size: 11px;
      color: var(--muted);
      opacity: 0.8;
    }

    .spread-area {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px 4px 2px;
    }

    .spread {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
    }

    .card-slot {
      width: 92px;
      max-width: 24vw;
      aspect-ratio: 70 / 120;
      border-radius: 9px;
      border: 1px dashed rgba(245, 210, 124, 0.35);
      background: radial-gradient(circle at top, #191b2a 0, #050610 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .card-slot img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-slot::after {
      content: attr(data-label);
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(246, 246, 246, 0.8);
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.85);
      padding: 2px 6px;
      background: linear-gradient(
        to right,
        rgba(5, 6, 12, 0.9),
        rgba(5, 6, 12, 0.1)
      );
      border-radius: 999px;
      backdrop-filter: blur(4px);
    }

    .card-slot.placeholder::after {
      content: "";
    }

    .card-slot.placeholder {
      border-style: dotted;
      opacity: 0.25;
    }

    /* === SPREAD LAYOUTS === */

    /* Default: flex row for 1, 3, 6 etc */
    .spread-1,
    .spread-3,
    .spread-6 {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    /* 4-card spread: row on desktop, 2x2 on mobile */
    .spread-4 {
      display: grid;
      gap: 10px;
      justify-items: center;
    }

    @media (min-width: 721px) {
      .spread-4 {
        grid-template-columns: repeat(4, minmax(70px, 1fr));
      }
    }

    @media (max-width: 720px) {
      .spread-4 {
        grid-template-columns: repeat(2, minmax(70px, 1fr)); /* 2 top, 2 bottom */
      }
    }

    /* 5-card spread: 
       - desktop: 5 in a row
       - mobile: 3 columns x 2 rows with one empty slot in top row (for clarifier ‚Äúpocket‚Äù) */
    .spread-5 {
      display: grid;
      gap: 10px;
      justify-items: center;
      width: 100%;
    }

    @media (min-width: 721px) {
      .spread-5 {
        grid-template-columns: repeat(5, minmax(70px, 1fr));
      }
    }

    @media (max-width: 720px) {
      .spread-5 {
        grid-template-columns: repeat(3, minmax(70px, 1fr));
      }
    }

    .spread-5 .card-slot.placeholder {
      /* invisible but keeps the space */
      visibility: hidden;
    }

    /* 6-card spread (3 x 2 grid) */
    .spread-6 {
      display: grid;
      gap: 10px;
      justify-items: center;
      width: 100%;
    }

    @media (min-width: 721px) {
      .spread-6 {
        grid-template-columns: repeat(6, minmax(70px, 1fr));
      }
    }

    @media (max-width: 720px) {
      .spread-6 {
        grid-template-columns: repeat(3, minmax(70px, 1fr));
      }
    }

    /* === Clarifiers === */

    .clarifier-section {
      margin-top: 6px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: radial-gradient(circle at top, #151726 0, #05060f 70%);
      padding: 8px 10px 10px;
    }

    .clarifier-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .clarifier-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
    }

    .clarifier-toggle {
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .clarifier-toggle-icon {
      display: inline-block;
      transition: transform 0.18s ease;
    }

    .clarifier-toggle.open .clarifier-toggle-icon {
      transform: rotate(180deg);
    }

    .clarifier-row {
      display: flex;
      gap: 6px;
      padding-top: 6px;
      overflow: hidden;
      transition: max-height 0.18s ease;
      max-height: 0;
    }

    .clarifier-row.expanded {
      max-height: 140px; /* enough to show 1 row of small cards */
    }

    .clarifier-card-slot {
      width: 64px;
      max-width: 18vw;
      aspect-ratio: 70 / 120;
      border-radius: 8px;
      border: 1px solid rgba(245, 210, 124, 0.45);
      background: radial-gradient(circle at top, #191b2a 0, #05060f 70%);
      overflow: hidden;
      position: relative;
    }

    .clarifier-card-slot img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .clarifier-card-slot::after {
      content: attr(data-label);
      position: absolute;
      bottom: 3px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 7px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: rgba(246, 246, 246, 0.9);
      padding: 1px 4px;
      background: rgba(5, 6, 12, 0.9);
      border-radius: 999px;
      max-width: 95%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .clarifier-empty-hint {
      font-size: 11px;
      color: var(--muted);
      opacity: 0.75;
      padding-top: 6px;
    }

    /* Small helper text under controls */
    .helper-text {
      font-size: 10px;
      color: var(--muted);
      margin-top: 3px;
      opacity: 0.8;
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div>
        <div class="title">AVATAROT</div>
        <div class="subtitle">Elemental Tarot Engine</div>
      </div>
    </header>

    <section class="controls">
      <label for="spreadSelect">Spread</label>
      <select id="spreadSelect">
        <option value="1">Single Card</option>
        <option value="3">3&nbsp;Card</option>
        <option value="4">4&nbsp;Card</option>
        <option value="5">5&nbsp;Card</option>
        <option value="6">6&nbsp;Card</option>
      </select>

      <div class="controls-row">
        <button id="drawBtn" class="primary">Draw Spread</button>
        <button id="clarifierBtn">Add Clarifier</button>
        <button id="resetBtn">Reset</button>
      </div>
    </section>
    <div class="helper-text">
      Clarifier pile holds up to 5 cards. When you add a 6th, the oldest card
      is released.
    </div>

    <section class="spread-panel">
      <div class="spread-header">
        <div class="spread-title">Current Spread</div>
        <div class="spread-meta" id="spreadMeta">No cards drawn yet</div>
      </div>
      <div id="spreadArea" class="spread-area">
        <!-- Cards will be injected here -->
      </div>
    </section>

    <section class="clarifier-section">
      <div class="clarifier-header">
        <div class="clarifier-label">Clarifier Pile (max 5)</div>
        <button id="clarifierToggle" class="clarifier-toggle">
          <span>Collapse / Expand</span>
          <span class="clarifier-toggle-icon">‚ñæ</span>
        </button>
      </div>
      <div id="clarifierRow" class="clarifier-row">
        <!-- Clarifier cards injected here -->
      </div>
      <div id="clarifierEmptyHint" class="clarifier-empty-hint">
        No clarifiers yet. Tap ‚ÄúAdd Clarifier‚Äù after your main spread.
      </div>
    </section>
  </div>

  <script>
    // ==========================================================
    //  1) DECK SETUP
    // ==========================================================
    // IMPORTANT:
    // Replace this dummy deck with your REAL deck array from your old file.
    //
    // You probably already have something like:
    //   const deck = [{ name: 'The Fool', img: 'img/fool.png' }, ...]
    //
    // Just copy that part from your old index.html and paste it
    // in place of the "dummy" deck below, keeping the variable
    // name EXACTLY "deck".

    const deck = [
      // üîªüîªüîª REPLACE EVERYTHING INSIDE THIS ARRAY WITH YOUR REAL CARDS üîªüîªüîª
      // Example format:
      // { name: 'The Fool', img: 'cards/fool.png' },
      // { name: 'The Magician', img: 'cards/magician.png' },
      // ...
      {
        name: "Placeholder Card",
        img: ""
      }
      // üî∫üî∫üî∫ REPLACE EVERYTHING ABOVE WITH YOUR REAL DECK ARRAY üî∫üî∫üî∫
    ];

    // ==========================================================
    //  2) STATE
    // ==========================================================

    let workingDeck = [];
    let spreadCards = [];
    let clarifiers = [];

    const spreadSelect = document.getElementById("spreadSelect");
    const spreadArea = document.getElementById("spreadArea");
    const spreadMeta = document.getElementById("spreadMeta");

    const drawBtn = document.getElementById("drawBtn");
    const clarifierBtn = document.getElementById("clarifierBtn");
    const resetBtn = document.getElementById("resetBtn");

    const clarifierRow = document.getElementById("clarifierRow");
    const clarifierEmptyHint = document.getElementById("clarifierEmptyHint");
    const clarifierToggle = document.getElementById("clarifierToggle");
    const clarifierToggleIcon = clarifierToggle.querySelector(
      ".clarifier-toggle-icon"
    );

    // ==========================================================
    //  3) UTILITIES
    // ==========================================================

    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function resetDeck(keepSpread = false) {
      workingDeck = shuffle(deck);
      if (!keepSpread) {
        spreadCards = [];
      }
      clarifiers = [];
      renderSpread();
      renderClarifiers();
      spreadMeta.textContent = "Deck reset. No cards drawn yet.";
    }

    function drawCard() {
      if (workingDeck.length === 0) {
        workingDeck = shuffle(deck);
      }
      return workingDeck.pop();
    }

    // ==========================================================
    //  4) SPREAD DRAW + RENDER
    // ==========================================================

    function drawSpread() {
      const size = parseInt(spreadSelect.value, 10);
      spreadCards = [];

      for (let i = 0; i < size; i++) {
        spreadCards.push(drawCard());
      }

      renderSpread();
      spreadMeta.textContent = `${size}-card spread drawn.`;
    }

    function createCardSlot(card, isPlaceholder = false) {
      const slot = document.createElement("div");
      slot.classList.add("card-slot");
      if (isPlaceholder) {
        slot.classList.add("placeholder");
        slot.dataset.label = "";
      } else if (card) {
        slot.dataset.label = card.name || "";
        if (card.img && card.img.trim() !== "") {
          const img = document.createElement("img");
          img.src = card.img;
          img.alt = card.name || "Card";
          slot.appendChild(img);
        }
      }
      return slot;
    }

    function renderSpread() {
      spreadArea.innerHTML = "";

      if (!spreadCards.length) {
        const msg = document.createElement("div");
        msg.style.fontSize = "12px";
        msg.style.color = "#a1a5b5";
        msg.style.textAlign = "center";
        msg.textContent =
          "Use ‚ÄúDraw Spread‚Äù to pull cards from your AVATAROT deck.";
        spreadArea.appendChild(msg);
        return;
      }

      const size = spreadCards.length;
      const spreadContainer = document.createElement("div");
      spreadContainer.classList.add("spread", `spread-${size}`);

      if (size === 4) {
        // Straight-forward: 4 cards, the CSS handles layout
        spreadCards.forEach((card) => {
          spreadContainer.appendChild(createCardSlot(card));
        });
      } else if (size === 5) {
        // 5-card special layout:
        // For mobile: 3 columns x 2 rows:
        // Row 1: Card 1, Card 2, [EMPTY PLACEHOLDER]
        // Row 2: Card 3, Card 4, Card 5
        // On desktop: 5 in a row; placeholder falls to next line but is invisible.

        if (spreadCards[0])
          spreadContainer.appendChild(createCardSlot(spreadCards[0]));
        if (spreadCards[1])
          spreadContainer.appendChild(createCardSlot(spreadCards[1]));

        // Empty slot to "reserve" space visually for clarifier pocket on mobile
        spreadContainer.appendChild(createCardSlot(null, true));

        if (spreadCards[2])
          spreadContainer.appendChild(createCardSlot(spreadCards[2]));
        if (spreadCards[3])
          spreadContainer.appendChild(createCardSlot(spreadCards[3]));
        if (spreadCards[4])
          spreadContainer.appendChild(createCardSlot(spreadCards[4]));
      } else {
        // 1, 3, 6 handled generically
        spreadCards.forEach((card) => {
          spreadContainer.appendChild(createCardSlot(card));
        });
      }

      spreadArea.appendChild(spreadContainer);
    }

    // ==========================================================
    //  5) CLARIFIERS
    // ==========================================================

    function addClarifier() {
      if (!spreadCards.length) {
        // no main spread yet; still allow clarifier but update meta
        spreadMeta.textContent = "Clarifier drawn without main spread.";
      }

      const card = drawCard();
      clarifiers.push(card);

      // Limit to 5, remove the oldest when the 6th is added
      if (clarifiers.length > 5) {
        clarifiers.shift();
      }

      renderClarifiers();

      // Auto-expand clarifier section the first time it gets cards
      if (!clarifierRow.classList.contains("expanded")) {
        clarifierRow.classList.add("expanded");
        clarifierToggle.classList.add("open");
      }
    }

    function renderClarifiers() {
      clarifierRow.innerHTML = "";

      if (!clarifiers.length) {
        clarifierEmptyHint.style.display = "block";
        return;
      }

      clarifierEmptyHint.style.display = "none";

      clarifiers.forEach((card) => {
        const slot = document.createElement("div");
        slot.classList.add("clarifier-card-slot");
        slot.dataset.label = card.name || "";

        if (card.img && card.img.trim() !== "") {
          const img = document.createElement("img");
          img.src = card.img;
          img.alt = card.name || "Clarifier card";
          slot.appendChild(img);
        }

        clarifierRow.appendChild(slot);
      });
    }

    // ==========================================================
    //  6) CLARIFIER COLLAPSE / EXPAND
    // ==========================================================

    clarifierToggle.addEventListener("click", () => {
      const expanded = clarifierRow.classList.toggle("expanded");
      if (expanded) {
        clarifierToggle.classList.add("open");
      } else {
        clarifierToggle.classList.remove("open");
      }
    });

    // ==========================================================
    //  7) BUTTON EVENTS
    // ==========================================================

    drawBtn.addEventListener("click", drawSpread);
    clarifierBtn.addEventListener("click", addClarifier);
    resetBtn.addEventListener("click", () => resetDeck(false));

    // Init
    resetDeck(false);
  </script>
</body>
</html>
