<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>AVATAROT</title>
  <style>
    :root {
      --bg: #050609;
      --card-bg: radial-gradient(circle at 20% 0%, #1b2a3d, #050609);
      --accent: #fdd166;
      --accent-soft: rgba(253, 209, 102, 0.25);
      --border-subtle: rgba(255, 255, 255, 0.12);
      --text-main: #f5f5f5;
      --text-muted: rgba(245,245,245,0.72);
      --danger: #ff6b81;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0;
      padding: 16px 16px 28px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app { max-width: 1040px; margin: 0 auto; }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 4px;
      letter-spacing: 0.18em;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(253,209,102,0.6);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    button {
      flex: 1;
      padding: 11px 8px;
      border-radius: 999px;
      border: none;
      font-size: 0.95rem;
      font-weight: 550;
      letter-spacing: 0.02em;
      cursor: pointer;
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, #fdd166, #ffb347);
      color: #160f02;
      box-shadow: 0 6px 14px rgba(0,0,0,0.35);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.04);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
    }

    .btn-danger {
      background: rgba(255,107,129,0.12);
      color: var(--danger);
      border: 1px solid rgba(255,107,129,0.5);
    }

    .meta-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-bottom: 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .badge {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 0.75rem;
    }

    .main-layout {
      margin-top: 10px;
    }

    .card-display { margin-top: 4px; }

    .tarot-card {
      position: relative;
      border-radius: 18px;
      padding: 14px 14px 12px;
      background: var(--card-bg);
      border: 1px solid var(--accent-soft);
      box-shadow: 0 14px 30px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .tarot-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 20% 0%, rgba(253,209,102,0.22), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .card-image-wrap {
      position: relative;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.16);
      background: radial-gradient(circle at 20% 0%, #223046, #050609);
      max-height: 75vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-image-wrap::before {
      content: "";
      display: block;
      padding-top: 190%; /* tall enough for 6-card layout */
    }

    #cardImg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      transition: transform 0.15s ease-out;
      z-index: 5;
    }

    .spread-overlay {
      position: absolute;
      inset: 0;
      padding: 6px;
      display: none;
      z-index: 10;
    }

    .spread-grid {
      width: 100%;
      height: 100%;
      display: grid;
      grid-auto-rows: minmax(0, 1fr);
      gap: 4px;
      justify-items: center;
      align-items: center;
    }

    .spread-card {
      width: 100%;
      height: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.55);
      padding: 2px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, border-color 0.12s;
    }

    .spread-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 10px rgba(0,0,0,0.5);
      border-color: rgba(253,209,102,0.6);
    }

    .spread-card-img-wrap {
      flex: 1;
      width: 100%;
      border-radius: 7px;
      overflow: hidden;
      background: radial-gradient(circle at 20% 0%, #223046, #050609);
    }

    .spread-card-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      transition: transform 0.15s ease-out;
    }

    .tarot-footer {
      position: relative;
      font-size: 0.75rem;
      opacity: 0.7;
      display: flex;
      justify-content: flex-end;
      margin-top: 2px;
    }

    /* Floating clarifier inside main box */
    .floating-clarifier {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 120px;
      z-index: 40;
      border-radius: 14px;
      padding: 6px;
      background: radial-gradient(circle at 20% 0%, #22293c, #050609);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 12px 24px rgba(0,0,0,0.65);
      transition: transform 0.15s ease-out, opacity 0.15s ease-out;
    }

    .floating-clarifier:hover {
      transform: translateY(-2px);
    }

    .floating-clarifier img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      border-radius: 10px;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(120%);
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.9);
      color: var(--text-main);
      font-size: 0.8rem;
      box-shadow: 0 10px 24px rgba(0,0,0,0.8);
      opacity: 0;
      transition: transform 0.25s ease-out, opacity 0.25s ease-out;
      pointer-events: none;
      z-index: 50;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="pill">
      <div class="pill-dot"></div>
      AVATAROT • Pocket Deck
    </div>

    <h1>AVATAROT</h1>

    <!-- main controls -->
    <div class="controls">
      <button id="shuffleBtn" class="btn-primary">Shuffle</button>
      <button id="drawBtn" class="btn-secondary">+1 clarifier</button>
      <button id="resetBtn" class="btn-danger">Reset deck</button>
    </div>

    <!-- spread controls -->
    <div class="controls">
      <button id="spread2Btn" class="btn-secondary">2-card spread</button>
      <button id="spread3Btn" class="btn-secondary">3-card spread</button>
      <button id="spread4Btn" class="btn-secondary">4-card spread</button>
      <button id="spread5Btn" class="btn-secondary">5-card spread</button>
      <button id="spreadPyramidBtn" class="btn-secondary">6-card spread</button>
      <button id="clearSpreadBtn" class="btn-danger">Clear spread</button>
    </div>

    <div class="meta-row">
      <div class="badge" id="statusBadge">Fresh deck</div>
    </div>

    <div class="main-layout">
      <div class="card-display">
        <div class="tarot-card" id="cardView">
          <!-- floating clarifier lives here -->
          <div id="floatingClarifier"></div>

          <div class="card-image-wrap">
            <img id="cardImg" alt="Avatarot card" src="">
            <div class="spread-overlay" id="spreadOverlay">
              <div class="spread-grid" id="spreadGrid"></div>
            </div>
          </div>

          <div class="tarot-footer">
            <span id="spreadCount">0 in spread</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Deck data
    const fullDeck = [
      { id: 0, name: "The Fool (Aang)", img: "fool_aang.png" },
      { id: 1, name: "The Magician (Avatar State Aang)", img: "magician_aang.png" },
      { id: 2, name: "The High Priestess (Yue)", img: "high_priestess_yue.png" },
      { id: 3, name: "The Empress (Katara)", img: "empress_katara.png" },
      { id: 4, name: "The Emperor (Zuko)", img: "emperor_zuko.png" },
      { id: 5, name: "The Hierophant (Guru Pathik)", img: "hierophant_pathik.png" },
      { id: 6, name: "The Lovers (Sokka & Suki)", img: "lovers_sokka_suki.png" },
      { id: 7, name: "The Chariot (Appa)", img: "chariot_appa.png" },
      { id: 8, name: "Strength (Azula)", img: "strength_azula.png" },
      { id: 9, name: "The Hermit (Gyatso)", img: "hermit_gyasto.png" },   // filename fixed
      { id: 10, name: "Wheel of Fortune", img: "wheel_of_fortune.png" },
      { id: 11, name: "Justice (Kyoshi)", img: "justice_kyoshi.png" },
      { id: 12, name: "The Hanged Man (Bumi)", img: "hanged_man_bumi.png" },
      { id: 13, name: "Death (Iroh)", img: "death_iroh.png" },
      { id: 14, name: "Temperance (Iroh Tea)", img: "temperance_iroh_tea.png" },
      { id: 15, name: "The Devil (Ozai)", img: "devil_ozai.png" },
      { id: 16, name: "The Tower (Ba Sing Se)", img: "tower_ba_sing_se.png" },
      { id: 17, name: "The Star", img: "star.png" },
      { id: 18, name: "The Moon", img: "moon.png" },
      { id: 19, name: "The Sun", img: "sun.png" },
      { id: 20, name: "Judgement (Lion Turtle)", img: "judgement_lion_turtle.png" },
      { id: 21, name: "The World (4 Nations Map)", img: "world_map.png" },
      { id: 22, name: "Ace of Wands", img: "ace_wands.png" },
      { id: 23, name: "Two of Wands", img: "two_wands.png" },
      { id: 24, name: "Three of Wands", img: "three_wands.png" },
      { id: 25, name: "Four of Wands", img: "four_wands.png" },
      { id: 26, name: "Five of Wands", img: "five_wands.png" },
      { id: 27, name: "Six of Wands", img: "six_wands.png" },
      { id: 28, name: "Seven of Wands", img: "seven_wands.png" },
      { id: 29, name: "Eight of Wands", img: "eight_wands.png" },
      { id: 30, name: "Nine of Wands", img: "nine_wands.png" },
      { id: 31, name: "Ten of Wands", img: "ten_wands.png" },
      { id: 32, name: "Page of Wands", img: "page_wands.png" },
      { id: 33, name: "Knight of Wands", img: "knight_wands.png" },
      { id: 34, name: "Queen of Wands", img: "queen_wands.png" },
      { id: 35, name: "King of Wands", img: "king_wands.png" },
      { id: 36, name: "Ace of Cups", img: "ace_cups.png" },
      { id: 37, name: "Two of Cups", img: "two_cups.png" },
      { id: 38, name: "Three of Cups", img: "three_cups.png" },
      { id: 39, name: "Four of Cups", img: "four_cups.png" },
      { id: 40, name: "Five of Cups", img: "five_cups.png" },
      { id: 41, name: "Six of Cups", img: "six_cups.png" },
      { id: 42, name: "Seven of Cups", img: "seven_cups.png" },
      { id: 43, name: "Eight of Cups", img: "eight_cups.png" },
      { id: 44, name: "Nine of Cups", img: "nine_cups.png" },
      { id: 45, name: "Ten of Cups", img: "ten_cups.png" },
      { id: 46, name: "Page of Cups", img: "page_cups.png" },
      { id: 47, name: "Knight of Cups", img: "knight_cups.png" },
      { id: 48, name: "Queen of Cups", img: "queen_cups.png" },
      { id: 49, name: "King of Cups", img: "king_cups.png" },
      { id: 50, name: "Ace of Swords", img: "ace_swords.png" },
      { id: 51, name: "Two of Swords", img: "two_swords.png" },
      { id: 52, name: "Three of Swords", img: "three_swords.png" },
      { id: 53, name: "Four of Swords", img: "four_swords.png" },
      { id: 54, name: "Five of Swords", img: "five_swords.png" },
      { id: 55, name: "Six of Swords", img: "six_swords.png" },
      { id: 56, name: "Seven of Swords", img: "seven_swords.png" },
      { id: 57, name: "Eight of Swords", img: "eight_swords.png" },
      { id: 58, name: "Nine of Swords", img: "nine_swords.png" },
      { id: 59, name: "Ten of Swords", img: "ten_swords.png" },
      { id: 60, name: "Page of Swords", img: "page_swords.png" },
      { id: 61, name: "Knight of Swords", img: "knight_swords.png" },
      { id: 62, name: "Queen of Swords", img: "queen_swords.png" },
      { id: 63, name: "King of Swords", img: "king_swords.png" },
      { id: 64, name: "Ace of Pentacles", img: "ace_pentacles.png" },
      { id: 65, name: "Two of Pentacles", img: "two_pentacles.png" },
      { id: 66, name: "Three of Pentacles", img: "three_pentacles.png" },
      { id: 67, name: "Four of Pentacles", img: "four_pentacles.png" },
      { id: 68, name: "Five of Pentacles", img: "five_pentacles.png" },
      { id: 69, name: "Six of Pentacles", img: "six_pentacles.png" },
      { id: 70, name: "Seven of Pentacles", img: "seven_pentacles.png" },
      { id: 71, name: "Eight of Pentacles", img: "eight_pentacles.png" },
      { id: 72, name: "Nine of Pentacles", img: "nine_pentacles.png" },
      { id: 73, name: "Ten of Pentacles", img: "ten_pentacles.png" },
      { id: 74, name: "Page of Pentacles", img: "page_pentacles.png" },
      { id: 75, name: "Knight of Pentacles", img: "knight_pentacles.png" },
      { id: 76, name: "Queen of Pentacles", img: "queen_pentacles.png" },
      { id: 77, name: "King of Pentacles", img: "king_pentacles.png" }
    ];

    let deck = [];
    let spread = [];       // [{card, revealed}]
    let spreadType = null; // 'line' or 'pyramid6'
    let lastClarifier = null;

    const shuffleBtn = document.getElementById('shuffleBtn');
    const drawBtn = document.getElementById('drawBtn');
    const resetBtn = document.getElementById('resetBtn');

    const spread2Btn = document.getElementById('spread2Btn');
    const spread3Btn = document.getElementById('spread3Btn');
    const spread4Btn = document.getElementById('spread4Btn');
    const spread5Btn = document.getElementById('spread5Btn');
    const spreadPyramidBtn = document.getElementById('spreadPyramidBtn');
    const clearSpreadBtn = document.getElementById('clearSpreadBtn');

    const statusBadge = document.getElementById('statusBadge');
    const toast = document.getElementById('toast');
    const cardImg = document.getElementById('cardImg');

    const spreadOverlay = document.getElementById('spreadOverlay');
    const spreadGrid = document.getElementById('spreadGrid');
    const spreadCount = document.getElementById('spreadCount');
    const floatingClarifier = document.getElementById('floatingClarifier');

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 1700);
    }

    function drawFromDeck() {
      if (deck.length === 0) return null;
      const card = deck.pop();
      card.reversed = Math.random() < 0.5;
      return card;
    }

    function showCardBack() {
      cardImg.src = 'backs/avatarot_back.png';
      cardImg.style.transform = 'none';
    }

    function resetDeck() {
      deck = [...fullDeck];
      spread = [];
      spreadType = null;
      lastClarifier = null;
      renderSpread();
      renderClarifier();
      showCardBack();
      spreadCount.textContent = '0 in spread';
      statusBadge.textContent = 'Fresh deck';
      showToast('Deck reset');
    }

    function shuffleDeck() {
      if (deck.length === 0) deck = [...fullDeck];
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      statusBadge.textContent = 'Shuffled';
      showToast('Deck shuffled');
    }

    function drawClarifier() {
      if (deck.length === 0) {
        showToast('Deck is empty – reset to draw again');
        statusBadge.textContent = 'Empty deck';
        return;
      }
      const card = drawFromDeck();
      lastClarifier = card;
      renderClarifier();
      showCardInMainView(card);
      statusBadge.textContent = 'Clarifier drawn';
      showToast('Clarifier drawn');
    }

    function drawSpread(count, type) {
      if (deck.length === 0) {
        showToast('Deck is empty – reset to draw again');
        statusBadge.textContent = 'Empty deck';
        return;
      }
      if (deck.length < count) {
        showToast('Not enough cards left for that spread');
        return;
      }
      spreadType = type || 'line';
      spread = [];
      for (let i = 0; i < count; i++) {
        const card = drawFromDeck();
        spread.push({ card, revealed: false });
      }
      renderSpread();
      showCardBack();
      statusBadge.textContent = 'Spread set';
      showToast(count + '-card spread ready – tap to reveal');
    }

    function clearSpread() {
      spread = [];
      spreadType = null;
      renderSpread();
      showToast('Spread cleared');
      if (lastClarifier) {
        showCardInMainView(lastClarifier);
      } else {
        showCardBack();
      }
    }

    function revealCardAt(index) {
      const slot = spread[index];
      if (!slot || slot.revealed) return;
      slot.revealed = true;
      renderSpread();
      showCardInMainView(slot.card);
      statusBadge.textContent = 'Revealed card ' + (index + 1);
    }

    function showCardInMainView(card) {
      if (card.img) {
        cardImg.src = card.img;
      } else {
        cardImg.src = 'backs/avatarot_back.png';
      }
      cardImg.style.transform = card.reversed ? 'rotate(180deg)' : 'none';
    }

    function renderSpread() {
      spreadGrid.innerHTML = '';

      if (spread.length === 0) {
        spreadOverlay.style.display = 'none';
        cardImg.style.display = 'block';
        spreadCount.textContent = '0 in spread';
        return;
      }

      spreadOverlay.style.display = 'block';
      cardImg.style.display = 'none';

      if (spreadType === 'pyramid6') {
        spreadGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
      } else {
        const cols = Math.max(1, spread.length); // 2–5 in one line
        spreadGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      }

      spread.forEach((slot, index) => {
        const wrap = document.createElement('div');
        wrap.className = 'spread-card';

        if (spreadType === 'pyramid6') {
          const map = [
            { row: 1, col: 1 },
            { row: 1, col: 2 },
            { row: 1, col: 3 },
            { row: 2, col: 1 },
            { row: 2, col: 2 },
            { row: 2, col: 3 }
          ];
          const pos = map[index] || { row: 2, col: 2 };
          wrap.style.gridRow = pos.row;
          wrap.style.gridColumn = pos.col;
        } else {
          wrap.style.gridRow = '1';
        }

        const imgWrap = document.createElement('div');
        imgWrap.className = 'spread-card-img-wrap';

        const img = document.createElement('img');
        img.className = 'spread-card-img';

        if (slot.revealed && slot.card.img) {
          img.src = slot.card.img;
        } else {
          img.src = 'backs/avatarot_back.png';
        }
        img.alt = '';
        img.style.transform = slot.revealed && slot.card.reversed ? 'rotate(180deg)' : 'none';

        imgWrap.appendChild(img);
        wrap.appendChild(imgWrap);
        wrap.addEventListener('click', () => revealCardAt(index));

        spreadGrid.appendChild(wrap);
      });

      spreadCount.textContent = spread.length + ' in spread';
    }

    function renderClarifier() {
      floatingClarifier.innerHTML = '';
      floatingClarifier.className = 'floating-clarifier';

      const img = document.createElement('img');
      if (!lastClarifier) {
        img.src = 'backs/avatarot_back.png';
        img.style.opacity = '0.5';
      } else {
        img.src = lastClarifier.img || 'backs/avatarot_back.png';
        img.style.transform = lastClarifier.reversed ? 'rotate(180deg)' : 'none';
      }
      img.alt = '';
      floatingClarifier.appendChild(img);
    }

    // Wire up buttons
    shuffleBtn.addEventListener('click', shuffleDeck);
    drawBtn.addEventListener('click', drawClarifier);
    resetBtn.addEventListener('click', resetDeck);

    spread2Btn.addEventListener('click', () => drawSpread(2, 'line'));
    spread3Btn.addEventListener('click', () => drawSpread(3, 'line'));
    spread4Btn.addEventListener('click', () => drawSpread(4, 'line'));
    spread5Btn.addEventListener('click', () => drawSpread(5, 'line'));
    spreadPyramidBtn.addEventListener('click', () => drawSpread(6, 'pyramid6'));

    clearSpreadBtn.addEventListener('click', clearSpread);

    // Init
    resetDeck();
  </script>
</body>
</html>
